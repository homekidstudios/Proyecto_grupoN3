<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Finance - Grupo 03</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --brand-blue: #0052cc;
            --light-blue: #f0f7ff;
            --dark-navy: #091e42;
            --accent-cyan: #00b8d9;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f4f7fa;
            color: var(--dark-navy);
        }

        /* Diseño Animalista/Orgánico: Formas de Guijarro */
        .pebble-card {
            background: white;
            border-radius: 35px;
            border: 1px solid rgba(0, 82, 204, 0.08);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.03);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }

        .pebble-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 35px -10px rgba(0, 82, 204, 0.1);
        }

        .btn-organic {
            border-radius: 20px;
            padding: 8px 24px;
            font-weight: 700;
            font-size: 0.75rem;
            transition: all 0.3s ease;
        }

        .tab-active {
            background-color: var(--brand-blue);
            color: white;
            box-shadow: 0 8px 15px -4px rgba(0, 82, 204, 0.4);
        }

        .chart-container {
            position: relative;
            height: 280px;
            width: 100%;
        }

        /* Estilo de la Hoja de Auditoría */
        .audit-paper {
            border-radius: 40px;
            background: linear-gradient(135deg, #ffffff 0%, #f9fbff 100%);
            border: 2px solid #eef2f8;
        }

        .report-pill {
            background: var(--light-blue);
            border-left: 4px solid var(--brand-blue);
            padding: 1rem;
            border-radius: 12px 24px 24px 12px;
        }

        /* Animaciones */
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        input[type="number"] {
            border-radius: 18px;
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            padding: 12px 20px;
            font-weight: 800;
            color: var(--brand-blue);
            outline: none;
            width: 100%;
        }

        input[type="number"]:focus {
            border-color: var(--brand-blue);
            background: white;
        }

        /* Avatar System */
        .avatar-container {
            position: relative;
            width: 110px;
            height: 110px;
            margin-bottom: 1.5rem;
        }

        .team-avatar {
            width: 110px;
            height: 110px;
            border-radius: 38px;
            object-fit: cover;
            background: var(--light-blue);
            border: 4px solid white;
            box-shadow: 0 8px 15px rgba(0,0,0,0.05);
            transition: all 0.5s ease;
        }

        .avatar-change-btn {
            position: absolute;
            bottom: -5px;
            right: -5px;
            background: var(--brand-blue);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            z-index: 10;
        }

        .avatar-change-btn:hover {
            transform: rotate(15deg) scale(1.1);
            background: var(--accent-cyan);
        }

        .avatar-loading {
            opacity: 0.5;
            filter: grayscale(1);
            transform: scale(0.9);
        }

        /* Estilo Colab Section */
        .colab-section {
            background: linear-gradient(135deg, #091e42 0%, #0052cc 100%);
            border-radius: 40px;
            position: relative;
            overflow: hidden;
        }

        .colab-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -10%;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            filter: blur(40px);
        }

        .colab-button {
            background: #f9ab00; 
            color: white;
            border-radius: 20px;
            padding: 12px 28px;
            font-weight: 800;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(249, 171, 0, 0.3);
        }

        .colab-button:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 30px rgba(249, 171, 0, 0.5);
            background: #e69d00;
        }
    </style>
</head>
<body class="antialiased pb-20">

    <!-- Header / Navbar -->
    <header class="max-w-7xl mx-auto px-6 py-6 flex flex-col md:flex-row justify-between items-center gap-6">
        <div class="flex items-center gap-4">
            <div class="w-14 h-14 bg-blue-600 rounded-[22px] flex items-center justify-center text-white shadow-xl shadow-blue-200 animate-float">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
            </div>
            <div>
                <h1 class="text-2xl font-extrabold tracking-tight text-slate-900">Financial Insights</h1>
                <p class="text-[10px] font-bold text-blue-500 uppercase tracking-[0.3em]">Data Science - Grupo 03</p>
            </div>
        </div>

        <nav class="flex gap-2 bg-white/80 backdrop-blur-md p-1.5 rounded-[25px] border border-slate-200 shadow-sm">
            <button onclick="showSection('dashboard')" id="nav-dash" class="btn-organic tab-active uppercase tracking-wider">Dashboard</button>
            <button onclick="showSection('diagrams')" id="nav-diag" class="btn-organic text-slate-400 hover:text-blue-600 uppercase tracking-wider">Diagramas</button>
        </nav>
    </header>

    <main class="max-w-7xl mx-auto px-6 mt-6">

        <!-- SECCIÓN DASHBOARD -->
        <div id="section-dashboard" class="space-y-8">
            
            <!-- Grid de KPIs -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Input Presupuesto -->
                <div class="pebble-card p-8 bg-slate-900 text-white border-none shadow-2xl">
                    <span class="text-[10px] font-black text-blue-400 uppercase tracking-widest">Entrada de Datos</span>
                    <h3 class="text-lg font-bold mt-2 mb-4">Presupuesto (B)</h3>
                    <div class="relative">
                        <span class="absolute left-4 top-3 text-slate-400 font-bold">$</span>
                        <input type="number" id="budgetInput" value="60" oninput="runAnalysis()" class="pl-10 text-xl border-none ring-2 ring-slate-800 focus:ring-blue-500 bg-slate-800 text-white">
                    </div>
                </div>

                <!-- Total Gastado -->
                <div class="pebble-card p-8 bg-blue-600 text-white border-none">
                    <span class="text-[10px] font-bold text-blue-100 uppercase tracking-widest">Gasto Acumulado</span>
                    <div id="weeklyTotal" class="text-5xl font-black mt-3">$0.00</div>
                    <div class="mt-6 flex items-center justify-between">
                        <span class="text-[10px] font-medium opacity-80">PROGRESO SEMANAL</span>
                        <span id="progressPercent" class="text-xs font-black">0%</span>
                    </div>
                    <div class="mt-2 w-full bg-blue-800/40 h-2.5 rounded-full overflow-hidden">
                        <div id="progressBar" class="bg-white h-full transition-all duration-1000" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Estado del Presupuesto -->
                <div id="statusCard" class="pebble-card p-8 flex flex-col justify-center items-center text-center">
                    <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Estado Financiero</span>
                    <div id="statusLabel" class="text-2xl font-black text-slate-800">CARGANDO</div>
                    <p id="statusSub" class="text-[10px] font-bold text-slate-400 uppercase mt-2">Analizando algoritmos...</p>
                    <div class="mt-4 p-2 rounded-full bg-slate-50 w-full flex justify-center">
                        <div id="statusIndicator" class="w-3 h-3 rounded-full bg-slate-300"></div>
                    </div>
                </div>

                <!-- Categoría Crítica -->
                <div class="pebble-card p-8 bg-white border-t-8 border-blue-600">
                    <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Categoría Dominante</span>
                    <div id="dominantCat" class="text-2xl font-black text-blue-700 mt-2">---</div>
                    <div id="dominantVal" class="text-sm font-bold text-slate-500 mt-1">$0.00 USD</div>
                    <div class="mt-6 text-[9px] bg-blue-50 text-blue-600 px-3 py-1 rounded-full font-black inline-block uppercase">Punto de atención</div>
                </div>
            </div>

            <!-- Gráficas -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="pebble-card p-10">
                    <h4 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-8">Tendencia Diaria vs Límite</h4>
                    <div class="chart-container">
                        <canvas id="lineChart"></canvas>
                    </div>
                </div>
                <div class="pebble-card p-10">
                    <h4 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-8">Balance por Categoría</h4>
                    <div class="chart-container">
                        <canvas id="barChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- INFORME DE AUDITORÍA -->
            <div class="audit-paper p-10 shadow-xl">
                <div class="flex items-center gap-4 mb-10 pb-6 border-b border-slate-100">
                    <div class="w-10 h-10 bg-blue-50 rounded-full flex items-center justify-center text-blue-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-xl font-black text-slate-800">Hoja de Auditoría Automática</h2>
                        <p class="text-[11px] font-bold text-slate-400 uppercase tracking-widest">Resultados del procesamiento de datos (Python Core)</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                    <div class="space-y-6">
                        <h3 class="text-[11px] font-black text-blue-600 uppercase tracking-widest">1. Resumen de Flujo</h3>
                        <div id="report-summary" class="space-y-4"></div>
                    </div>
                    <div class="space-y-6">
                        <h3 class="text-[11px] font-black text-blue-600 uppercase tracking-widest">2. Alertas de Umbral</h3>
                        <div id="report-alerts" class="space-y-2 max-h-[200px] overflow-y-auto pr-2"></div>
                    </div>
                    <div class="space-y-6">
                        <h3 class="text-[11px] font-black text-blue-600 uppercase tracking-widest">3. Recomendación Técnica</h3>
                        <div class="report-pill bg-blue-50/50">
                            <p id="report-conclusions" class="text-sm text-slate-600 leading-relaxed italic"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCIÓN DE INTEGRANTES INTERACTIVA -->
            <div class="mt-16 space-y-10">
                <div class="text-center">
                    <h2 class="text-2xl font-black text-slate-900">Equipo de Investigación</h2>
                    <p class="text-[10px] font-bold text-blue-500 uppercase tracking-[0.4em] mt-2">Personaliza los Avatares</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <!-- Integrante 1 -->
                    <div class="pebble-card p-6 flex flex-col items-center text-center">
                        <div class="avatar-container">
                            <div class="absolute -inset-1 bg-gradient-to-r from-blue-600 to-cyan-400 rounded-[38px] blur opacity-20"></div>
                            <img id="avatar-1" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Luis" alt="Luis" class="team-avatar relative">
                            <div onclick="changeAvatar(1)" class="avatar-change-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                </svg>
                            </div>
                        </div>
                        <h4 class="font-black text-slate-800 text-sm">Luis Alberto</h4>
                        <span class="text-[9px] font-bold text-blue-600 uppercase mt-1">Líder de Proyecto</span>
                        <p class="text-[11px] text-slate-400 mt-4 leading-relaxed">Especialista en estructuración de matrices y control presupuestario.</p>
                    </div>

                    <!-- Integrante 2 -->
                    <div class="pebble-card p-6 flex flex-col items-center text-center">
                        <div class="avatar-container">
                            <div class="absolute -inset-1 bg-gradient-to-r from-blue-600 to-cyan-400 rounded-[38px] blur opacity-20"></div>
                            <img id="avatar-2" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Maria" alt="María" class="team-avatar relative">
                            <div onclick="changeAvatar(2)" class="avatar-change-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                </svg>
                            </div>
                        </div>
                        <h4 class="font-black text-slate-800 text-sm">María Fernanda</h4>
                        <span class="text-[9px] font-bold text-blue-600 uppercase mt-1">Analista de Datos</span>
                        <p class="text-[11px] text-slate-400 mt-4 leading-relaxed">Encargada del procesamiento estadístico y validación de umbrales.</p>
                    </div>

                    <!-- Integrante 3 -->
                    <div class="pebble-card p-6 flex flex-col items-center text-center">
                        <div class="avatar-container">
                            <div class="absolute -inset-1 bg-gradient-to-r from-blue-600 to-cyan-400 rounded-[38px] blur opacity-20"></div>
                            <img id="avatar-3" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Carlos" alt="Carlos" class="team-avatar relative">
                            <div onclick="changeAvatar(3)" class="avatar-change-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                </svg>
                            </div>
                        </div>
                        <h4 class="font-black text-slate-800 text-sm">Carlos Javier</h4>
                        <span class="text-[9px] font-bold text-blue-600 uppercase mt-1">Desarrollador Python</span>
                        <p class="text-[11px] text-slate-400 mt-4 leading-relaxed">Responsable de la automatización de cálculos y bucles de control.</p>
                    </div>

                    <!-- Integrante 4 -->
                    <div class="pebble-card p-6 flex flex-col items-center text-center">
                        <div class="avatar-container">
                            <div class="absolute -inset-1 bg-gradient-to-r from-blue-600 to-cyan-400 rounded-[38px] blur opacity-20"></div>
                            <img id="avatar-4" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Elena" alt="Elena" class="team-avatar relative">
                            <div onclick="changeAvatar(4)" class="avatar-change-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                </svg>
                            </div>
                        </div>
                        <h4 class="font-black text-slate-800 text-sm">Elena Sofía</h4>
                        <span class="text-[9px] font-bold text-blue-600 uppercase mt-1">Diseñadora de UI</span>
                        <p class="text-[11px] text-slate-400 mt-4 leading-relaxed">Enfocada en la visualización de resultados y UX financiera.</p>
                    </div>
                </div>
            </div>

            <!-- SECCIÓN LABORATORIO COLAB -->
            <div class="colab-section p-10 md:p-16 text-white mt-12">
                <div class="flex flex-col md:flex-row items-center justify-between gap-10">
                    <div class="max-w-xl space-y-4">
                        <div class="inline-flex items-center gap-2 bg-white/10 px-4 py-1.5 rounded-full backdrop-blur-md">
                            <span class="w-2 h-2 rounded-full bg-yellow-400 animate-pulse"></span>
                            <span class="text-[10px] font-bold uppercase tracking-widest">Proyecto Open Source</span>
                        </div>
                        <h2 class="text-3xl font-black">Laboratorio de Código Python</h2>
                        <p class="text-blue-100 text-sm leading-relaxed opacity-80">
                            Explora la lógica matemática y el backend desarrollado en <span class="font-bold text-white underline decoration-yellow-500">Google Colab</span>. Todo el proceso está documentado en nuestro notebook.
                        </p>
                        <div class="pt-4">
                            <a href="https://colab.research.google.com/" target="_blank" class="colab-button">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12.5 4.5l-5 5-5-5 5-5 5 5zM12.5 19.5l-5 5-5-5 5-5 5 5zM21.5 12l-5 5-5-5 5-5 5 5z"/>
                                </svg>
                                ABRIR EN GOOGLE COLAB
                            </a>
                        </div>
                    </div>
                    <div class="hidden md:block w-full max-w-sm">
                        <div class="bg-slate-900/50 backdrop-blur-xl p-6 rounded-[30px] border border-white/10 font-mono text-[10px] text-blue-300 shadow-2xl">
                            <div class="flex gap-1.5 mb-4">
                                <div class="w-2.5 h-2.5 rounded-full bg-red-400/50"></div>
                                <div class="w-2.5 h-2.5 rounded-full bg-yellow-400/50"></div>
                                <div class="w-2.5 h-2.5 rounded-full bg-green-400/50"></div>
                            </div>
                            <p class="text-white"><span class="text-pink-400">import</span> numpy <span class="text-pink-400">as</span> np</p>
                            <p class="mt-1"><span class="text-blue-400">def</span> <span class="text-yellow-300">analizar_gastos</span>(matriz, presupuesto):</p>
                            <p class="pl-4 mt-1">totales = np.<span class="text-cyan-400">sum</span>(matriz, axis=1)</p>
                            <p class="pl-4">alertas = totales > (presupuesto * <span class="text-orange-400">0.2</span>)</p>
                            <p class="pl-4 mt-1"><span class="text-pink-400">return</span> np.<span class="text-cyan-400">where</span>(alertas)</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECCIÓN DIAGRAMAS -->
        <div id="section-diagrams" class="hidden space-y-8">
            <div class="pebble-card p-10 flex flex-col items-center">
                <div class="flex flex-wrap justify-center gap-3 mb-10 bg-slate-100 p-2 rounded-[30px]">
                    <button onclick="changeDiag('general')" class="diag-btn btn-organic tab-active">GENERAL</button>
                    <button onclick="changeDiag('suma')" class="diag-btn btn-organic text-slate-500">SUMA_LISTA</button>
                    <button onclick="changeDiag('cat')" class="diag-btn btn-organic text-slate-500">CATEGORÍAS</button>
                    <button onclick="changeDiag('clasifica')" class="diag-btn btn-organic text-slate-500">CLASIFICACIÓN</button>
                </div>
                <div class="w-full max-w-4xl">
                    <img id="mainDiagImg" src="https://via.placeholder.com/1000x600/f8fafc/0052cc?text=DIAGRAMA+GENERAL+PSeInt" class="w-full h-auto rounded-[40px] shadow-2xl border-[12px] border-white">
                </div>
            </div>
        </div>

    </main>

    <footer class="mt-20 py-10 text-center border-t border-slate-200">
        <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.5em]">UTMACH 2026 - Universidad Técnica de Machala</p>
    </footer>

    <script>
        const categorias = ["Alimentación", "Transporte", "Materiales", "Entretenimiento", "Otros"];
        const matrizGastos = [
            [4.50, 1.20, 0.00, 2.50, 0.80], [3.90, 1.20, 1.50, 0.00, 0.60],
            [5.10, 1.20, 0.00, 3.00, 0.00], [4.20, 1.20, 0.80, 0.00, 1.10],
            [6.00, 1.20, 0.00, 4.50, 0.00], [4.80, 1.20, 1.00, 0.00, 0.50],
            [5.50, 1.20, 0.00, 2.00, 0.90]
        ];

        let lineChart, barChart;

        // Función para cambiar avatar
        function changeAvatar(id) {
            const img = document.getElementById(`avatar-${id}`);
            const randomSeed = Math.random().toString(36).substring(7);
            
            img.classList.add('avatar-loading');
            
            // Simular carga de red para efecto visual
            setTimeout(() => {
                img.src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${randomSeed}`;
                img.onload = () => img.classList.remove('avatar-loading');
            }, 300);
        }

        function initCharts() {
            const commonOptions = {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { 
                    y: { grid: { color: '#f1f5f9' }, border: { display: false } },
                    x: { grid: { display: false } }
                }
            };

            lineChart = new Chart(document.getElementById('lineChart'), {
                type: 'line',
                data: {
                    labels: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'],
                    datasets: [{
                        label: 'Gasto Diario', borderColor: '#0052cc', backgroundColor: 'rgba(0, 82, 204, 0.1)',
                        fill: true, tension: 0.4, pointRadius: 6, pointBackgroundColor: '#fff', pointBorderWidth: 3, data: []
                    }, {
                        label: 'Umbral', borderColor: '#ff5252', borderWidth: 2, borderDash: [6, 6], data: [], pointRadius: 0
                    }]
                },
                options: commonOptions
            });

            barChart = new Chart(document.getElementById('barChart'), {
                type: 'bar',
                data: {
                    labels: categorias,
                    datasets: [{ backgroundColor: ['#0052cc', '#00b8d9', '#4c9aff', '#2684ff', '#091e42'], borderRadius: 15, data: [] }]
                },
                options: commonOptions
            });
        }

        function runAnalysis() {
            const B = parseFloat(document.getElementById('budgetInput').value) || 1;
            const threshold = B * 0.20;

            let dailyTotals = matrizGastos.map(dia => dia.reduce((a, b) => a + b, 0));
            let categoryTotals = [0, 0, 0, 0, 0];
            matrizGastos.forEach(dia => {
                dia.forEach((gasto, i) => categoryTotals[i] += gasto);
            });

            const totalSemanal = dailyTotals.reduce((a, b) => a + b, 0);

            document.getElementById('weeklyTotal').innerText = `$${totalSemanal.toFixed(2)}`;
            const perc = Math.min((totalSemanal / B) * 100, 100);
            document.getElementById('progressBar').style.width = perc + '%';
            document.getElementById('progressPercent').innerText = perc.toFixed(0) + '%';

            const statusLabel = document.getElementById('statusLabel');
            const statusSub = document.getElementById('statusSub');
            const indicator = document.getElementById('statusIndicator');

            if (totalSemanal <= 0.90 * B) {
                statusLabel.innerText = "ESTABLE";
                statusLabel.className = "text-2xl font-black text-blue-600";
                statusSub.innerText = "Dentro de los parámetros";
                indicator.className = "w-3 h-3 rounded-full bg-blue-500 shadow-[0_0_10px_rgba(59,130,246,0.5)]";
            } else if (totalSemanal <= B) {
                statusLabel.innerText = "RIESGO";
                statusLabel.className = "text-2xl font-black text-amber-500";
                statusSub.innerText = "Cerca del agotamiento";
                indicator.className = "w-3 h-3 rounded-full bg-amber-500 shadow-[0_0_10px_rgba(245,158,11,0.5)]";
            } else {
                statusLabel.innerText = "CRÍTICO";
                statusLabel.className = "text-2xl font-black text-red-500";
                statusSub.innerText = "Sobregiro detectado";
                indicator.className = "w-3 h-3 rounded-full bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.5)]";
            }

            const maxIdx = categoryTotals.indexOf(Math.max(...categoryTotals));
            document.getElementById('dominantCat').innerText = categorias[maxIdx].toUpperCase();
            document.getElementById('dominantVal').innerText = `$${categoryTotals[maxIdx].toFixed(2)} Acumulado`;

            lineChart.data.datasets[0].data = dailyTotals;
            lineChart.data.datasets[1].data = Array(7).fill(threshold);
            lineChart.update();
            barChart.data.datasets[0].data = categoryTotals;
            barChart.update();

            document.getElementById('report-summary').innerHTML = `
                <div class="flex justify-between border-b pb-2"><span class="text-slate-400">Techo Semanal</span><span class="font-bold">$${B.toFixed(2)}</span></div>
                <div class="flex justify-between border-b pb-2"><span class="text-slate-400">Total Consumido</span><span class="font-bold">$${totalSemanal.toFixed(2)}</span></div>
                <div class="flex justify-between"><span class="text-slate-400">Disponibilidad</span><span class="font-bold text-blue-600">$${Math.max(0, B - totalSemanal).toFixed(2)}</span></div>
            `;

            let alerts = dailyTotals.map((t, i) => t > threshold ? `Día ${i+1}: $${t.toFixed(2)}` : null).filter(x => x);
            document.getElementById('report-alerts').innerHTML = alerts.length > 0 
                ? alerts.map(a => `<div class="p-2 bg-red-50 text-red-600 rounded-lg text-[10px] font-bold border border-red-100 flex items-center gap-2"><div class="w-1.5 h-1.5 rounded-full bg-red-600"></div> ${a} EXCESO</div>`).join('')
                : `<p class="text-[10px] text-slate-300">No se detectaron excesos diarios.</p>`;

            document.getElementById('report-conclusions').innerText = `El algoritmo identifica que la categoría de ${categorias[maxIdx]} es la responsable del ${(categoryTotals[maxIdx]/totalSemanal*100).toFixed(1)}% del gasto total.`;
        }

        function showSection(id) {
            document.getElementById('section-dashboard').classList.toggle('hidden', id !== 'dashboard');
            document.getElementById('section-diagrams').classList.toggle('hidden', id !== 'diagrams');
            document.getElementById('nav-dash').className = `btn-organic uppercase tracking-wider ${id === 'dashboard' ? 'tab-active' : 'text-slate-400 hover:text-blue-600'}`;
            document.getElementById('nav-diag').className = `btn-organic uppercase tracking-wider ${id === 'diagrams' ? 'tab-active' : 'text-slate-400 hover:text-blue-600'}`;
        }

        function changeDiag(type) {
            const diags = { 'general': 'GENERAL', 'suma': 'SUMA_LISTA', 'cat': 'CATEGORÍAS', 'clasifica': 'CLASIFICACIÓN' };
            document.getElementById('mainDiagImg').src = `https://via.placeholder.com/1000x600/f8fafc/0052cc?text=DIAGRAMA+${diags[type]}`;
            document.querySelectorAll('.diag-btn').forEach(btn => btn.classList.remove('tab-active'));
            event.target.classList.add('tab-active');
        }

        window.onload = () => { initCharts(); runAnalysis(); };
    </script>
</body>
</html>
